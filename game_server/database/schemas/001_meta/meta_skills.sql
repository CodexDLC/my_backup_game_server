
CREATE TABLE IF NOT EXISTS special_stat_effects (
    effect_id SERIAL PRIMARY KEY,               -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤–ª–∏—è–Ω–∏—è.
    
    stat_key VARCHAR(50) NOT NULL,             -- ‚úÖ –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ê-–ò–°–¢–û–ß–ù–ò–ö: –ù–∞–ø—Ä–∏–º–µ—Ä, 'Strength', 'Agility', 'Intelligence'.
                                                -- –≠—Ç–æ –±–∞–∑–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ.

    affected_property VARCHAR(100) NOT NULL,    -- ‚úÖ –°–í–û–ô–°–¢–í–û-–¶–ï–õ–¨: –ù–∞–ø—Ä–∏–º–µ—Ä, 'MaxHealth', 'MeleeDamage', 'CritChance', 'SpellPower', 'MoveSpeed'.
                                                -- –ò–≥—Ä–æ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞.

    effect_type VARCHAR(50) NOT NULL,           -- ‚úÖ –¢–ò–ü –í–õ–ò–Ø–ù–ò–Ø:
                                                -- 'flat_bonus_per_point': –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É stat_key. (–ü—Ä–∏–º–µ—Ä: +2 HP –∑–∞ 1 Endurance)
                                                -- 'percentage_bonus_per_point': –î–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –±–æ–Ω—É—Å –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É stat_key. (–ü—Ä–∏–º–µ—Ä: +0.5% –∫ —É—Ä–æ–Ω—É –∑–∞ 1 Strength)
                                                -- 'set_base_value': –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è affected_property, –µ—Å–ª–∏ stat_key –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ (–º–µ–Ω–µ–µ —á–∞—Å—Ç–æ).
                                                -- (–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å 'threshold_bonus', 'scaling_factor' –∏ —Ç.–¥. –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.)

    value NUMERIC(12,4) NOT NULL,               -- ‚úÖ –ó–ù–ê–ß–ï–ù–ò–ï –≠–§–§–ï–ö–¢–ê: –ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç effect_type.
                                                -- –ï—Å–ª–∏ 'flat_bonus_per_point', —Ç–æ 10 (–¥–ª—è 10 HP).
                                                -- –ï—Å–ª–∏ 'percentage_bonus_per_point', —Ç–æ 0.005 (–¥–ª—è 0.5%).
    
    calculation_order INTEGER DEFAULT 100,      -- –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–∏—è—é—Ç –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–≤–æ–π—Å—Ç–≤–æ.
                                                -- –í–∞–∂–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤: —Å–Ω–∞—á–∞–ª–∞ –æ–¥–Ω–∏ —ç—Ñ—Ñ–µ–∫—Ç—ã, –ø–æ—Ç–æ–º –¥—Ä—É–≥–∏–µ.
    description TEXT,                           -- –û–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤–ª–∏—è–Ω–∏—è.
    
    -- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–≤–æ–π—Å—Ç–≤–∞ –±—ã–ª —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–∏–ø –≤–ª–∏—è–Ω–∏—è
    CONSTRAINT uq_stat_property_effect_type UNIQUE (stat_key, affected_property, effect_type)
);


CREATE TABLE IF NOT EXISTS abilities (
    ability_id SERIAL PRIMARY KEY,              -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
    ability_key VARCHAR(100) NOT NULL UNIQUE,   -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'FIREBALL', 'SHIELD_BASH', 'CRITICAL_STRIKE_MASTERY')
    name VARCHAR(255) NOT NULL,                 -- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
    description TEXT,                           -- –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
    ability_type VARCHAR(50) NOT NULL,          -- –¢–∏–ø —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: 'active', 'passive', 'toggle' (–ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º–∞—è)
    
    -- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
    required_skill_key VARCHAR(50),             -- –°—Å—ã–ª–∫–∞ –Ω–∞ skill_key, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è —ç—Ç–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'FIRE_MAGIC')
    required_skill_level INTEGER DEFAULT 0,     -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤ required_skill_key –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    required_stats JSONB,                       -- JSONB: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, {"Intelligence": 15})
    required_items JSONB,                       -- JSONB: –¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã/—ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, {"weapon_type": "staff"})

    -- –≠—Ñ—Ñ–µ–∫—Ç—ã –∏ –∑–∞—Ç—Ä–∞—Ç—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
    cost_type VARCHAR(50),                      -- –¢–∏–ø –∑–∞—Ç—Ä–∞—Ç: 'mana', 'stamina', 'energy', 'none'
    cost_amount INTEGER DEFAULT 0,              -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ç—Ä–∞—Ç
    cooldown_seconds INTEGER DEFAULT 0,         -- –í—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    cast_time_ms INTEGER DEFAULT 0,             -- –í—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    effect_data JSONB,                          -- JSONB: –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, {"damage_type": "fire", "base_damage": 10, "scaling_stat": "Intelligence"})
    
    -- –í–∏–∑—É–∞–ª—å–Ω—ã–µ/–∞—É–¥–∏–æ —ç—Ñ—Ñ–µ–∫—Ç—ã
    animation_key VARCHAR(100),                 -- –ö–ª—é—á –∞–Ω–∏–º–∞—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é
    sfx_key VARCHAR(100),                       -- –ö–ª—é—á –∑–≤—É–∫–æ–≤–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
    vfx_key VARCHAR(100),                       -- –ö–ª—é—á –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞

    CONSTRAINT fk_ability_skill_key FOREIGN KEY (required_skill_key) REFERENCES skills(skill_key) ON DELETE SET NULL
);



CREATE TABLE IF NOT EXISTS skill_exclusions (
    exclusion_id SERIAL PRIMARY KEY,            -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    group_name VARCHAR(100) NOT NULL UNIQUE,   -- –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Light_Dark_Magic', 'Elemental_Affinity'). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.
    description TEXT,                           -- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –µ—ë –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.
    exclusion_type VARCHAR(50) NOT NULL,        -- –¢–∏–ø –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
                                                -- 'mutually_exclusive': –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –Ω–∞–≤—ã–∫ –∏–∑ —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω ('PLUS').
                                                -- 'debuff_on_others': –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –Ω–∞–≤—ã–∫–∞ –¥–µ–±–∞—Ñ—Ñ–∞–µ—Ç (–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å) –¥—Ä—É–≥–∏–µ –≤ –≥—Ä—É–ø–ø–µ, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é.
    
    excluded_skills JSONB NOT NULL,             -- JSONB-–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö `skill_key` (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã `skills`), –∫–æ—Ç–æ—Ä—ã–µ –≤—Ö–æ–¥—è—Ç –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É.
                                                -- –ü—Ä–∏–º–µ—Ä: '["LIGHT_MAGIC", "DARK_MAGIC"]'
                                                -- –ü—Ä–∏–º–µ—Ä: '["FIRE_MAGIC", "WATER_MAGIC", "EARTH_MAGIC", "AIR_MAGIC"]'
    
    exclusion_effect JSONB                      -- JSONB-–æ–±—ä–µ–∫—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–º –Ω–∞–≤—ã–∫–∞–º.
                                                -- –ü—Ä–∏–º–µ—Ä –¥–ª—è 'mutually_exclusive': '{"on_exclude_set_state": "PAUSE"}'
                                                -- –ü—Ä–∏–º–µ—Ä –¥–ª—è 'debuff_on_others': '{"on_exclude_set_state": "MINUS", "level_penalty_percent": 10}'
);



-- üîπ –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ –Ω–∞–≤—ã–∫–æ–≤
CREATE TABLE IF NOT EXISTS skills (
    skill_id SERIAL PRIMARY KEY,            -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –Ω–∞–≤—ã–∫–∞, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
    skill_key VARCHAR(50) NOT NULL UNIQUE,  -- ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û: –°—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'SWORD_MASTERY', 'MON_ACID_BREATH')
    name VARCHAR(255),                      -- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –Ω–∞–≤—ã–∫–∞
    skill_group VARCHAR(50),                -- –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–≤—ã–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Combat', 'Crafting')
    main_special VARCHAR(50),               -- –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å—Ç–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Strength', 'Perception')
    secondary_special VARCHAR(50),          -- –ù–∞–∑–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Agility', 'Intelligence')
    max_level INTEGER NOT NULL DEFAULT 5    -- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ (—Å–µ–π—á–∞—Å 5)
);
