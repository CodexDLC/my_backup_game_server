import discord
from typing import List, Dict, Any

class MapLocationSelect(discord.ui.Select):
    """
    –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–µ.
    """
    def __init__(self, locations: List[Dict[str, Any]]):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–π.

        Args:
            locations (List[Dict[str, Any]]): 
                –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –ª–æ–∫–∞—Ü–∏—é.

                # =================================================================
                # –ü–†–ò–ú–ï–ß–ê–ù–ò–ï –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø:
                # –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –í–†–ï–ú–ï–ù–ù–ê–Ø —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—É—é –º—ã –æ–∂–∏–¥–∞–µ–º –æ—Ç –±—ç–∫–µ–Ω–¥–∞.
                # –ö–æ–≥–¥–∞ –≤—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ—Å—å —Å —Ç–æ—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö,
                # –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥ –≤ —Ü–∏–∫–ª–µ `for loc in locations:` –Ω–∏–∂–µ,
                # —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –≤–∞—à–∏–º –Ω–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏—è–º –ø–æ–ª–µ–π.
                # 
                # –ü–†–ò–ú–ï–† –í–†–ï–ú–ï–ù–ù–û–ô –°–¢–†–£–ö–¢–£–†–´:
                # [
                #   {'id': 'loc_01', 'name': '–¢–∞–≤–µ—Ä–Ω–∞ "–ü—å—è–Ω—ã–π –ì–æ–±–ª–∏–Ω"', 'travel_time': 5},
                #   {'id': 'loc_02', 'name': '–†—ã–Ω–æ—á–Ω–∞—è –ø–ª–æ—â–∞–¥—å', 'travel_time': 10},
                # ]
                # =================================================================
        """
        
        options: List[discord.SelectOption] = []
        
        # --- –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ---
        # –≠—Ç–æ—Ç —Ü–∏–∫–ª –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å –±—ç–∫–µ–Ω–¥–∞.
        for loc in locations:
            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é .get(), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫,
            # –µ—Å–ª–∏ –∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
            label_text = loc.get('name', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è')
            value_id = str(loc.get('id', 'error_id'))
            description_text = f"–í—Ä–µ–º—è –≤ –ø—É—Ç–∏: {loc.get('travel_time', '?')} –º–∏–Ω."
            
            options.append(discord.SelectOption(
                label=label_text,
                value=value_id,
                description=description_text,
                emoji="üìç"
            ))
        # --- –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ---

        super().__init__(
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è...",
            min_values=1,
            max_values=1,
            options=options,
            disabled=(not locations) # –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –µ—Å–ª–∏ –ª–æ–∫–∞—Ü–∏–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–µ—Ç
        )

    async def callback(self, interaction: discord.Interaction):
        """
        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –≤—ã–±–æ—Ä.
        –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É View.
        """
        if self.values:
            if hasattr(self.view, 'on_location_select'):
                await self.view.on_location_select(interaction, self.values[0])