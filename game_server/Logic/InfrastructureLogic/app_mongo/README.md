# game_server/Logic/InfrastructureLogic/app_mongo

Эта папка предназначена для всей логики, связанной с **взаимодействием с MongoDB**. MongoDB используется для **хранения и управления динамическими данными, которые формируются во время активной работы сервера**. Это включает в себя, но не ограничивается, **состоянием мира для отображения**, а также данными, связанными с отправкой ответов и задач боту, и маршрутизацией команд от роутов к соответствующим сервисам.

## Текущее состояние и Предлагаемая Архитектура

На текущий момент, папка `app_mongo` содержит базовый клиент для MongoDB. Однако, для обеспечения масштабируемости, чистоты кода и удобства поддержки, рекомендуется развивать эту часть архитектуры, следуя принципам, уже примененным для PostgreSQL и Redis слоев.

**Предлагаемая будущая архитектура включает:**

1. **Централизованный MongoDB-клиент (`mongo_client.py`):**
    * Будет являться низкоуровневым интерфейсом для взаимодействия с сервером MongoDB.
    * Должен инкапсулировать логику подключения, управления соединениями (пулами) и базовые операции с коллекциями.
    * Может предоставлять методы для выполнения CRUD-операций, а также для работы с BSON-сериализацией/десериализацией.

2. **Доменно-ориентированные Репозитории MongoDB (`mongo_groups/` - предлагается к созданию):**
    * Будут основной компонентой для структурированного доступа к данным MongoDB.
    * Репозитории будут организованы по **доменным папкам**, каждая из которых будет соответствовать определенному типу динамических данных или коллекции в MongoDB.
    * **Примеры доменов**: `world_state/` (для динамического состояния мира), `bot_commands/` (для команд, отправляемых боту), `bot_responses/` (для ответов бота), `service_commands/` (для команд, отправляемых роутами сервисам).
    * **Интерфейсы (`interfaces_*.py`)**: В каждой доменной папке будет файл `interfaces_имя_группы.py`, который определяет **абстрактные базовые классы (ABC)** для репозиториев этого домена. Эти интерфейсы задают контракт (методы, их сигнатуры), который должен быть реализован.
    * **Реализации (`*_impl.py`)**: В каждой доменной папки будут находиться файлы `*_impl.py`, содержащие конкретные реализации репозиториев MongoDB. Эти классы будут наследовать от соответствующих `ABC` интерфейсов и инкапсулировать логику взаимодействия с MongoDB-клиентом для операций с конкретными коллекциями. Они будут принимать экземпляр централизованного MongoDB-клиента через свой конструктор (`__init__`).

3. **Централизованный Менеджер Репозиториев MongoDB (`mongo_repository_manager.py` - предлагается к созданию):**
    * Аналогично `RepositoryManager` для PostgreSQL, будет агрегировать все доменно-ориентированные репозитории MongoDB.
    * Будет предоставлять единую точку входа для доступа ко всем репозиториям MongoDB через свойства (например, `mongo_repo_manager.world_state.get_current_map(...)`).
    * Этот менеджер будет принимать экземпляр централизованного MongoDB-клиента в своём конструкторе и использовать его для создания экземпляров всех репозиториев, передавая им клиент.

4. **Инициализация (`app_mongo_initializer.py` - предлагается к созданию):**
    * Будет отвечать за инициализацию `mongo_client` и `mongo_repository_manager` при старте приложения, обеспечивая их готовность к работе.

## Содержимое Папки (Текущее и Предполагаемое Будущее)

* **`mongo_client.py`**: Базовый низкоуровневый клиент для подключения к MongoDB.
* `mongo_groups/` **(Предполагается)**: Будет содержать доменно-ориентированные папки с интерфейсами и реализациями репозиториев MongoDB, например:
  * `world_state/` (для динамического состояния мира)
    * `bot_commands/`
    * `bot_responses/`
    * `service_commands/`
* `mongo_repository_manager.py` **(Предполагается)**: Централизованный фасад для доступа ко всем репозиториям MongoDB.
* `app_mongo_initializer.py` **(Предполагается)**: Модуль для инициализации компонентов MongoDB.
