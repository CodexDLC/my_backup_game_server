# 6. Инфраструктура и масштабирование

**Цель:** обеспечить надёжную работу при росте нагрузки.

1. **Шардирование:** `character_id % N` на N воркеров.
2. **Пул соединений и батчи:** операции в одной транзакции.
3. **Кэш/Redis:** хранение `auto_sessions` или пулов.
4. **Автоскейлинг:** метрики + Kubernetes.
5. **Логирование:**

   * Распределение по шардам и воркерам.
   * Время выполнения батчей.
   * Ошибки подключения к Redis или БД.
6. **Метрики Prometheus:**

   * `shard_batch_duration_seconds`
   * `redis_cache_hits_total`
   * `worker_errors_total`
   * `k8s_autoscale_triggers_total`
