# 4. Открытие способностей

**Цель:** после повышения уровня навыка разблокировать новые способности.

1. При `level` → сделать один запрос к `skill_ability_unlocks`.
2. Вставить в `character_abilities`, избегая дубликатов.
3. Логирование разблокировки: персонаж, навык, уровень, способность.
4. Тесты: отсутствие дубликатов, корректность вставок.
5. **Логирование:**

   * Попытки вставки новых способностей: `character_id`, `skill_id`, `level`, `ability_id`.
   * Пропущенные из-за дубликатов.
   * Ошибки вставки.
6. **Метрики Prometheus:**

   * `ability_unlocks_total`
   * `ability_unlock_errors_total`
   * `ability_unlock_duration_seconds`
